<!-- page3_financial_services.html -->
{% extends "comparison.html" %}
{% block content %}

<div class="comparison-header-controls">

  <!-- Filter Data -->
  <div class="filter-data">
    <strong>Filter Data</strong>
    <p>Refine the chart view using the service type filter.</p>

    <select class="service-filter" id="serviceFilter">
      {% for s in service_types %}
        <option value="{{ s }}" {% if s == selected_filter %}selected{% endif %}>{{ s }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- Explore Data -->
  <div class="explore-data">
    <strong>Explore Data</strong>
    <p>Click here to explore the data</p>

    <div class="tab-buttons">
      <a href="{{ url_for('detailed_table_banks', banks=banks, filter=selected_filter) }}" class="tab">
        <i class="fas fa-table"></i> Detailed Table
      </a>

      <a href="{{ url_for('financial_services', banks=banks, filter=selected_filter) }}" class="tab active">
        <i class="fas fa-dollar-sign"></i> Financial Services
      </a>

      <a
        href="{% if banks %}
                {{ url_for('visual_graphs', banks=banks, filter=selected_filter) }}
              {% else %}
                {{ url_for('comparison') }}
              {% endif %}"
        class="tab"
      >
        <i class="fas fa-chart-bar"></i> Visual Graphs
      </a>

      <a
        href="{% if banks %}
                {{ url_for('insights_summary', banks=banks, filter=selected_filter) }}
              {% else %}
                {{ url_for('comparison') }}
              {% endif %}"
        class="tab"
      >
        <i class="fas fa-lightbulb"></i> Insights Summary
      </a>
    </div>
  </div>
</div>

<!-- TABLE -->
<div class="comparison-table financial-services-table"
     style="--bank-cols: {{ selected_banks|length }};">

  <!-- Header row -->
  <div class="table-header-row services-header">
    <div class="header-cell service-col">Services</div>
    {% for bank in selected_banks %}
      <div class="header-cell bank-col">{{ bank.bank_code }}</div>
    {% endfor %}
  </div>

  <!-- Sections -->
  {% if financial_data_structured %}
    {% for section, services in financial_data_structured.items() %}
      <div class="section-header-row">
        <div class="section-header-cell">{{ section }}</div>
      </div>

      {% for row in services %}
        <div class="table-row">
          <div class="table-cell service-col-label">{{ row.service }}</div>

          {% for bank in selected_banks %}
            <div class="table-cell bank-col">
              {{ row[bank.bank_code] }}
            </div>
          {% endfor %}
        </div>
      {% endfor %}
    {% endfor %}
  {% else %}
    <div class="section-header-row">
      <div class="section-header-cell">No data to display.</div>
    </div>
  {% endif %}
</div>

<a href="{{ url_for('comparison') }}" class="select-banks-btn">
  <span class="icon">+</span>
  Select other banks
</a>

<!-- âœ… Filter JS -->
<script>
  const serviceFilter = document.getElementById("serviceFilter");
  serviceFilter.addEventListener("change", function () {
    const url = new URL(window.location.href);

    // keep banks, add/update filter
    url.searchParams.set("filter", this.value);

    // if banks param missing, do nothing (but in your case it exists)
    window.location.href = url.toString();
  });
</script>

{% endblock %}
